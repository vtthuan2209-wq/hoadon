<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>WebApp H√≥a ƒê∆°n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2a8bdc">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">

<style>
  html, body {
    font-family:"Times New Roman", serif;
    background:#f0f0f0;
    margin:0;
    padding:10px;
    touch-action: manipulation;
  }

  #invoice {
    background:#fff;
    padding:12px;
    max-width:100%;
    margin:auto;
    border:1px solid #ccc;
    font-size:14px;
  }

  h1 {
    text-align:center;
    margin:8px 0;
    font-size:22px;
  }

  table {
    width:100%;
    border-collapse:collapse;
    margin-top:6px;
    font-size:12px;
    table-layout:fixed;
  }

  th, td {
    border:1px solid #000;
    padding:2px 3px;
    text-align:center;
    line-height:1.2;
  }

  /* Input font-size ‚â•16px ƒë·ªÉ Safari kh√¥ng zoom */
  td input, .info input, #hotline {
    font-size:16px;
    padding:2px 4px;
    height:24px;
    box-sizing:border-box;
    text-align:right;
    border:1px solid #ccc;
  }

  .info {
    margin-bottom:2px;
    font-size:13px;
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    align-items:center;
  }

  .info label {
    font-weight:bold;
    margin-right:4px;
  }

  .controls {
    margin-top:12px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    justify-content:center;
  }

  .btn {
    flex:1;
    min-width:120px;
    padding:10px;
    border:none;
    border-radius:20px;
    background:#2a8bdc;
    color:#fff;
    font-size:14px;
    font-weight:bold;
    cursor:pointer;
    text-align:center;
  }

  .btn-danger {
    background:#e74c3c;
  }

  .footer {
    margin-top:10px;
    font-size:12px;
    display:flex;
    justify-content:space-between;
  }

  #previewImage {
    margin-top:10px;
    max-width:100%;
    display:none;
    border:1px solid #ccc;
  }

  #downloadLink {
    display:none;
    text-align:center;
    margin-top:8px;
    font-size:14px;
    color:blue;
  }

  /* T√πy ch·ªânh ƒë·ªô r·ªông c·ªôt */
  #productTable th:nth-child(2), #productTable td:nth-child(2) { width:55%; }
  #productTable th:nth-child(3), #productTable td:nth-child(3) { width:12%; }
  #productTable th:nth-child(4), #productTable td:nth-child(4) { width:25%; }

  .textlike {
    border:none;
    outline:none;
    background:transparent;
    font-size:16px;
  }

  @media(max-width:480px){
    #invoice{padding:8px;font-size:12px;}
    h1{font-size:18px;}
    table{font-size:12px;}
    td input{font-size:16px;}
    .controls{flex-direction:column;}
    .btn{min-width:100%;font-size:13px;padding:6px;}
  }
</style>
</head>
<body>
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
    .then(()=>console.log("SW registered"))
    .catch(err=>console.log(err));
}
</script>

<div id="invoice">
  <!-- Header -->
  <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
    <div style="flex:0 0 80px;">
      <img src="data:image/png;base64,..." alt="Logo" style="max-width:80px;">
    </div>
    <div style="text-align:right; flex:1; font-size:13px;">
      <div style="font-weight:bold; font-size:16px;">C√îNG TY TNHH G·ªñ M·ªòT T·∫§M</div>
      <div>Hotline: <input type="text" id="hotline" value="0568.638.638" class="textlike" style="width:70px;text-align:right;"></div>
      <div>X∆∞·ªüng: 138/3 APƒê03, P. An Ph√∫ ƒê√¥ng, Tp.HCM</div>
      <div>CH: 19 Hi·ªáp Th√†nh 43, P. T√¢n Th·ªõi Hi·ªáp, Tp.HCM</div>
    </div>
  </div>

  <h1>H√ìA ƒê∆†N</h1>

  <div class="info"><label>Kh√°ch h√†ng:</label> <input type="text" id="customer" placeholder="T√™n KH"></div>
  <div class="info"><label>SƒêT:</label> <input type="text" id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i"></div>
  <div class="info"><label>ƒêC:</label> <input type="text" id="address" placeholder="ƒê·ªãa ch·ªâ" style="flex:1"></div>

  <div style="overflow-x:auto;">
    <table id="productTable">
      <thead>
        <tr>
          <th>STT</th>
          <th>T√™n S·∫£n Ph·∫©m</th>
          <th>SL</th>
          <th>Th√†nh ti·ªÅn</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <table style="margin-top:0px;">
    <tr><td colspan="3" style="text-align:right">V·∫≠n chuy·ªÉn:</td><td><input type="text" id="shipping" value="0"></td></tr>
    <tr><td colspan="3" style="text-align:right">T·ªîNG ƒê∆†N:</td><td><input type="text" id="totalOrder" value="0" readonly></td></tr>
    <tr><td colspan="3" style="text-align:right">C·ªåC TR∆Ø·ªöC:</td><td><input type="text" id="deposit" value="0"></td></tr>
    <tr><td colspan="3" style="text-align:right">GIAO H√ÄNG THANH TO√ÅN:</td><td><input type="text" id="finalPay" value="0" readonly></td></tr>
  </table>

  <div class="footer">
    <div class="date"><input type="text" id="dateField" class="textlike" style="text-align:left; width:200px;"></div>
    <div class="writer">
      <div>Ng∆∞·ªùi vi·∫øt h√≥a ƒë∆°n</div>
      <div><input type="text" id="writerName" value="Thi√™n" class="textlike" style="text-align:center; width:100px; margin-top:4px;"></div>
    </div>
  </div>

  <div style="margin-top:6px; font-size:12px;">
    <p><b>T√™n: ƒêinh Duy Lu√¢n</b><br>STK: 974666<br>Ng√¢n h√†ng √Å Ch√¢u (ACB)</p>
  </div>
</div>

<!-- Controls -->
<div class="controls">
  <button id="addProduct" class="btn">‚ûï Th√™m s·∫£n ph·∫©m</button>
  <button id="removeProduct" class="btn btn-danger">‚ùå X√≥a s·∫£n ph·∫©m</button>
</div>
<div class="controls">
  <button class="btn" onclick="saveInvoice()">üíæ L∆∞u t·∫°m</button>
  <button class="btn" onclick="exportImage()">üñº Xu·∫•t ·∫£nh</button>
  <button class="btn btn-danger" onclick="clearInvoice()">üóë X√≥a</button>
</div>

<img id="previewImage" alt="Preview h√≥a ƒë∆°n">
<a id="downloadLink">‚¨áÔ∏è T·∫£i ·∫£nh v·ªÅ m√°y</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function formatNumber(value){return Number(value.toString().replace(/\D/g,"")||0).toLocaleString("vi-VN");}
function parseNumber(value){return parseInt(value.toString().replace(/\D/g,"")||0);}

function addRow(product="", qty=0, price=0){
  let tbody = document.querySelector("#productTable tbody");
  let rowCount = tbody.rows.length + 1;
  let row = document.createElement
